<?xml version="1.0"?>
<openerp>
<data>
    <!--ici-->

    <record model="ir.ui.view" id="mymail_message_form">
        <field name="name">mail_message_read_form</field>
        <field name="model">mail.message</field>
        <field name="inherit_id" ref="mail_full_expand.view" />
        <field name="arch" type="xml">
            <group position="before">
                <header>
                    <button string="Forward" name="on_message_forward"
                        type="object"
                        context="{'option':'forward'}"
                        class="oe_forward">
                    </button>
                    <button string="Reply" name="on_message_forward"
                        type="object"
                        context="{'option':'reply'}"
                        class="oe_reply">
                    </button>
                    <button name="toogle_messages_to_read"
                    string="toggle to_read"
                    type="object">
                    <!--attrs="{'invisible': [('to_read', '!=', 1)],}">-->
                    </button>
                    <button name="toogle_messages_starred"
                    string="toggle starred"
                    type="object">
                    <!--attrs="{'invisible': [('to_read', '!=', 1)],}">-->
                    </button>
                </header>
            </group>
            <field name="notified_partner_ids" position="after">
                <field name="id" groups="base.group_no_one"/>
                <field name="on_open" invisible="1"/>
                <field name="to_read"/>
                <field name="starred"/>
            </field>
            <field name="body" position="after">
                <notebook>
                    <page string="childs">
                        <field name="child_ids">
                            <tree string="Details">
                                <field name="id" groups="base.group_no_one"/>
                                <field name="to_read"/>
                                <field name="starred"/>
                                <field name="author_id"/>
                                <field name="subject" invisible="1"/>
                                <field name="short_description"/>
                                <field name="date"/>
                                <field name="partner_ids"/>
                            </tree>
                        </field>
                    </page>
                    <page string="parent">
                        <field name="parent_id" widget="many2one_clickable">
                            <!--todo afficher les champs suivants:-->
                            <tree string="Details">
                                <field name="starred"/>
                                <field name="author_id"/>
                                <field name="subject" invisible="1"/>
                                <field name="short_description"/>
                                <field name="date"/>
                                <field name="partner_ids"/>
                            </tree>
                        </field>
                    </page>
                    <page string="notifications">
                        <field name="notification_ids">
                            <tree string="Details">
                                <field name="partner_id"/>
                                <field name="is_read"/>
                                <field name="starred"/>
                                <field name="message_id"/>
                            </tree>
                        </field>
                    </page>
                </notebook>
            </field>
        </field>
    </record>

     <!--voir le tree de mail.mail dans setting pour les boutons-->
    <record model="ir.ui.view" id="mymail_message_tree">
        <field name="name">myMail.message.tree</field>
        <field name="model">mail.message</field>
        <field name="priority">28</field>
        <field name="arch" type="xml">
            <tree toolbar="True" string="Messages" class="mymailclass">
                <button name="set_messages_read"
                    string="set_messages_read"
                    confirm="Set these messages as read ?"
                    type="object"
                    icon="terp-check"
                    attrs="{
                        'invisible': [('to_read', '=', 1)],
                    }"
                    groups="base.group_no_one"
                />
                <button name="set_messages_read"
                    string="set_messages_read"
                    confirm="Set these messages as read ?"
                    type="object"
                    icon="terp-camera_test"
                    attrs="{
                        'invisible': [('to_read', '!=', 1)],
                    }"
                    groups="base.group_no_one"
                />
                <field name="id" groups="base.group_no_one"/>
                <field name="to_read"/>
                <field name="starred"/>
                <field name="author_id"/>
                <field name="subject" invisible="1"/>
                <field name="short_description"/>
                <field name="date"/>
                <field name="partner_ids"/>
                <field name="parent_id" invisible="1"/>
                <!--<div t-if="parent_id.id"><field name="parent_id.id"/></div>-->
                <!--<field name="child_ids"/>-->
            </tree>
        </field>
    </record>

    <record model="ir.ui.view" id="mymail_message_search">
        <field name="name">mymail.message.search</field>
        <field name="model">mail.message</field>
        <field name="priority">25</field>
        <field name="arch" type="xml">
            <search string="Messages Search">
                <field name="body" string="Content" filter_domain="['|', ('subject', 'ilike', self), ('body', 'ilike', self)]" />
                <field name="subject"/>
                <field name="type"/>
                <field name="author_id"/>
                <field name="partner_ids"/>
                <field name="model"/>
                <field name="res_id"/>
                <field name="parent_id"/>
                <filter string="To Read"
                        name="message_unread" help="Show messages to read"
                        domain="[('to_read', '=', True)]"/>
                <separator/>
                <filter string="Has attachments"
                        name="attachments"
                        domain="[('attachment_ids', '!=', False)]"/>
                <group expand="0" string="Group By">
                    <filter string="Type" name="thread" domain="[]" context="{'group_by':'type'}"/>
                    <filter string="Subtype" name="thread" domain="[]" context="{'group_by':'subtype_id'}"/>
                    <filter string="From" name="thread" domain="[]" context="{'group_by':'email_from'}"/>
                    <filter string="Author" name="thread" domain="[]" context="{'group_by':'author_id'}"/>
                    <!--todo-->
                    <!--<filter string="Date" name="thread" domain="[]" context="{'group_by':'date'}"/>-->
                    <!--todo-->
                </group>
            </search>
        </field>
    </record>

    <!-- To-Do views -->
    <record id="action_view_myToDo_message" model="ir.actions.act_window">
        <field name="name">read mail</field>
        <field name="res_model">mail.message</field>
        <field name="domain">[('starred', '=', True)]</field>
        <field name="search_view_id" ref="mymail_message_search"/>
    </record>

    <record id="action_view_myToDo_message_tree" model="ir.actions.act_window.view">
        <field eval="1" name="sequence"/>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="mymail_message_tree"/>
        <field name="act_window_id" ref="action_view_myToDo_message"/>
    </record>

    <record id="action_view_myToDo_message_form" model="ir.actions.act_window.view">
        <field eval="2" name="sequence"/>
        <field name="view_mode">form</field>
        <field name="view_id" ref="mymail_message_form"/>
        <field name="act_window_id" ref="action_view_myToDo_message"/>
    </record>

    <!-- To: Me views -->
    <record id="action_view_myNotification_message" model="ir.actions.act_window">
        <field name="name">read mail</field>
        <field name="res_model">mail.message</field>
        <field name="domain">[('partner_ids.user_ids', 'in', [uid])]</field>
        <field name="search_view_id" ref="mymail_message_search"/>
    </record>

    <record id="action_view_myNotification_message_tree" model="ir.actions.act_window.view">
        <field eval="1" name="sequence"/>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="mymail_message_tree"/>
        <field name="act_window_id" ref="action_view_myNotification_message"/>
    </record>

    <record id="action_view_myNotification_message_form" model="ir.actions.act_window.view">
        <field eval="2" name="sequence"/>
        <field name="view_mode">form</field>
        <field name="view_id" ref="mymail_message_form"/>
        <field name="act_window_id" ref="action_view_myNotification_message"/>
    </record>

    <!-- inbox views -->
    <record id="action_view_mymail_message" model="ir.actions.act_window">
        <field name="name">read mail</field>
        <field name="res_model">mail.message</field>
        <field name="domain">[('notification_ids.partner_id.user_ids', 'in', [uid])]</field>
        <field name="search_view_id" ref="mymail_message_search"/>
    </record>

    <record id="action_view_mymail_message_tree" model="ir.actions.act_window.view">
        <field eval="1" name="sequence"/>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="mymail_message_tree"/>
        <field name="act_window_id" ref="action_view_mymail_message"/>
    </record>

    <record id="action_view_mymail_message_form" model="ir.actions.act_window.view">
        <field eval="2" name="sequence"/>
        <field name="view_mode">form</field>
        <field name="view_id" ref="mymail_message_form"/>
        <field name="act_window_id" ref="action_view_mymail_message"/>
    </record>

    <!-- sent views -->
    <record id="action_view_mySent_message" model="ir.actions.act_window">
        <field name="name">read mail</field>
        <field name="res_model">mail.message</field>
        <field name="domain">[('author_id.user_ids', 'in', [uid])]</field>
        <field name="search_view_id" ref="mymail_message_search"/>
    </record>

    <record id="action_view_mySent_message_tree" model="ir.actions.act_window.view">
        <field eval="1" name="sequence"/>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="mymail_message_tree"/>
        <field name="act_window_id" ref="action_view_mySent_message"/>
    </record>

    <record id="action_view_mySent_message_form" model="ir.actions.act_window.view">
        <field eval="2" name="sequence"/>
        <field name="view_mode">form</field>
        <field name="view_id" ref="mymail_message_form"/>
        <field name="act_window_id" ref="action_view_mySent_message"/>
    </record>

    <!--preserve original views -->
    <record id="action_view_mail_message_tree" model="ir.actions.act_window.view">
        <field eval="1" name="sequence"/>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="mail.view_message_tree"/>
        <field name="act_window_id" ref="mail.action_view_mail_message"/>
    </record>

    <record id="action_view_mail_message_form" model="ir.actions.act_window.view">
        <field eval="2" name="sequence"/>
        <field name="view_mode">form</field>
        <field name="view_id" ref="mail.view_message_form"/>
        <field name="act_window_id" ref="mail.action_view_mail_message"/>
    </record>

    <!-- Add menu entry in Messaging -->
    <menuitem action="action_view_mymail_message" name="Inbox List" id="menu_inbox_list" sequence='10' parent="mail.mail_feeds" />
    <menuitem action="action_view_myNotification_message" name="To: me List" id="menu_to_me_list" sequence='11' parent="mail.mail_feeds" />
    <menuitem action="action_view_myToDo_message" name="To-do List" id="menu_to_do_list" sequence='12' parent="mail.mail_feeds" />
    <menuitem action="action_view_mySent_message" name="Sent List" id="menu_sent_list" sequence='13' parent="mail.mail_feeds" />

</data>
</openerp>

 <!--note : voir Wall Widget et  Thread Widget : affichage des emails et sous email-->